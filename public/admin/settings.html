<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ตั้งค่าระบบ - ระบบลงเวลาออนไลน์</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <!-- Google Font: Sarabun -->
    <link
      href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/admin-style.css" />
    <link rel="stylesheet" href="../css/settings-style.css" />
  </head>

  <body>
    <!-- ส่วนหัว -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container">
        <a class="navbar-brand" href="/admin/dashboard.html">
          <i class="fas fa-clock me-2"></i> ระบบลงเวลาออนไลน์
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link" href="/admin/dashboard.html">
                <i class="fas fa-tachometer-alt me-1"></i> แดชบอร์ด
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/time-logs.html">
                <i class="fas fa-clipboard-list me-1"></i> ประวัติการลงเวลา
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/employees.html">
                <i class="fas fa-users me-1"></i> จัดการพนักงาน
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/time-edit.html">
                <i class="fas fa-edit me-1"></i> แก้ไขการลงเวลา
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="/admin/settings.html">
                <i class="fas fa-cogs me-1"></i> ตั้งค่าระบบ
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/data-cleanup.html">
                <i class="fas fa-broom me-1"></i> จัดการข้อมูล
              </a>
            </li>
          </ul>
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="#" id="logout-btn">
                <i class="fas fa-sign-out-alt me-1"></i> ออกจากระบบ
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- เนื้อหาหลัก -->
    <div class="container py-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-cogs text-primary me-2"></i> ตั้งค่าระบบ</h2>
        <button id="save-all-btn" class="btn btn-success save-button">
          <i class="fas fa-save me-1"></i> บันทึกการตั้งค่าทั้งหมด
        </button>
      </div>

      <div class="row">
        <!-- ตั้งค่าองค์กร -->
        <div class="col-lg-6 col-md-12">
          <div class="card settings-card">
            <div class="card-header bg-white">
              <div class="d-flex align-items-center">
                <div
                  class="settings-icon bg-primary bg-opacity-10 text-primary me-3"
                >
                  <i class="fas fa-building"></i>
                </div>
                <h5 class="mb-0">ตั้งค่าองค์กร</h5>
              </div>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label for="organization_name" class="form-label"
                  >ชื่อหน่วยงาน</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="organization_name"
                  name="organization_name"
                />
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="work_start_time" class="form-label"
                    >เวลาเริ่มงาน</label
                  >
                  <input
                    type="time"
                    class="form-control"
                    id="work_start_time"
                    name="work_start_time"
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label for="work_end_time" class="form-label"
                    >เวลาเลิกงาน</label
                  >
                  <input
                    type="time"
                    class="form-control"
                    id="work_end_time"
                    name="work_end_time"
                  />
                </div>
              </div>

              <div class="mb-3">
                <label for="allowed_ip" class="form-label"
                  >IP Address ที่อนุญาต</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="allowed_ip"
                  name="allowed_ip"
                  placeholder="เช่น 192.168.1.1, 10.0.0.1"
                />
                <div class="form-text">
                  ว่างหากอนุญาตทุก IP (คั่นด้วยเครื่องหมายจุลภาค ,)
                </div>
              </div>

              <div class="mb-3">
                <label for="time_offset" class="form-label"
                  >ค่าชดเชยเวลา (นาที)</label
                >
                <div class="input-group">
                  <input
                    type="number"
                    class="form-control"
                    id="time_offset"
                    name="time_offset"
                    value="0"
                  />
                  <span class="input-group-text">นาที</span>
                </div>
                <div class="form-text">
                  กำหนดค่าชดเชยเวลา: 0 = เวลาปกติ, เป็นบวก =
                  เร็วกว่าความเป็นจริง, เป็นลบ = ช้ากว่าความเป็นจริง
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ตั้งค่า Google Apps Script -->
        <div class="col-lg-6 col-md-12">
          <div class="card settings-card">
            <div class="card-header bg-white">
              <div class="d-flex align-items-center">
                <div
                  class="settings-icon bg-success bg-opacity-10 text-success me-3"
                >
                  <i class="fas fa-cloud"></i>
                </div>
                <h5 class="mb-0">ตั้งค่า Google Apps Script</h5>
              </div>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label for="gas_web_app_url" class="form-label"
                  >Google Apps Script URL</label
                >
                <div class="input-group">
                  <input
                    type="text"
                    class="form-control"
                    id="gas_web_app_url"
                    name="gas_web_app_url"
                  />
                  <button
                    class="btn btn-outline-success"
                    type="button"
                    id="test-gas-btn"
                  >
                    ทดสอบ
                  </button>
                </div>
                <div class="form-text">
                  URL ที่ได้จากการ Deploy เป็น Web App (รูปแบบ:
                  https://script.google.com/macros/s/XXXX/exec)
                </div>
              </div>

              <div class="mb-3">
                <div class="form-check form-switch custom-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="use_gas_for_telegram"
                    name="use_gas_for_telegram"
                    value="1"
                    checked
                  />
                  <label class="form-check-label" for="use_gas_for_telegram"
                    >ใช้ Google Apps Script ในการสร้างแผนที่และส่งข้อความไป
                    Telegram</label
                  >
                </div>
                <div class="form-text">
                  เมื่อเปิดใช้งาน ระบบจะส่งข้อมูลไปยัง Google Apps Script
                  เพื่อสร้างแผนที่และส่งข้อความไป Telegram แทนการส่งโดยตรง
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ตั้งค่า Telegram -->
        <div class="col-lg-6 col-md-12">
          <div class="card settings-card">
            <div class="card-header bg-white">
              <div class="d-flex align-items-center">
                <div class="settings-icon bg-info bg-opacity-10 text-info me-3">
                  <i class="fab fa-telegram"></i>
                </div>
                <h5 class="mb-0">ตั้งค่า Telegram</h5>
              </div>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label for="telegram_bot_token" class="form-label"
                  >Telegram Bot Token</label
                >
                <div class="input-group">
                  <input
                    type="text"
                    class="form-control"
                    id="telegram_bot_token"
                    name="telegram_bot_token"
                  />
                  <button
                    class="btn btn-outline-info"
                    type="button"
                    id="test-notify-btn"
                  >
                    ทดสอบ
                  </button>
                </div>
                <div class="form-text">
                  สร้างได้ที่
                  <a href="https://t.me/BotFather" target="_blank"
                    >Telegram BotFather</a
                  >
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label">กลุ่ม Telegram สำหรับแจ้งเตือน</label>
                <div id="telegram-groups-container">
                  <!-- กลุ่ม Telegram จะถูกเพิ่มที่นี่ด้วย JavaScript -->
                </div>
                <button
                  class="btn btn-outline-primary btn-sm mt-2"
                  id="add-group-btn"
                  type="button"
                >
                  <i class="fas fa-plus-circle me-1"></i> เพิ่มกลุ่ม
                </button>
              </div>

              <div class="mb-3">
                <label class="form-label d-block">การแจ้งเตือน</label>
                <div class="notification-options">
                  <div class="form-check form-switch custom-switch">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="notify_clock_in"
                      name="notify_clock_in"
                      value="1"
                    />
                    <label class="form-check-label" for="notify_clock_in"
                      >ลงเวลาเข้า</label
                    >
                  </div>
                  <div class="form-check form-switch custom-switch">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="notify_clock_out"
                      name="notify_clock_out"
                      value="1"
                    />
                    <label class="form-check-label" for="notify_clock_out"
                      >ลงเวลาออก</label
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ตั้งค่าความปลอดภัย -->
        <div class="col-lg-6 col-md-12">
          <div class="card settings-card">
            <div class="card-header bg-white">
              <div class="d-flex align-items-center">
                <div
                  class="settings-icon bg-danger bg-opacity-10 text-danger me-3"
                >
                  <i class="fas fa-shield-alt"></i>
                </div>
                <h5 class="mb-0">ตั้งค่าความปลอดภัย</h5>
              </div>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label for="admin_username" class="form-label"
                  >ชื่อผู้ใช้ผู้ดูแลระบบ</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="admin_username"
                  name="admin_username"
                />
              </div>

              <div class="mb-3">
                <label for="admin_password" class="form-label"
                  >รหัสผ่านผู้ดูแลระบบ</label
                >
                <input
                  type="password"
                  class="form-control"
                  id="admin_password"
                  name="admin_password"
                />
                <div class="form-text">
                  เว้นว่างหากไม่ต้องการเปลี่ยนรหัสผ่าน
                </div>
              </div>

              <div class="mb-3">
                <label for="confirm_password" class="form-label"
                  >ยืนยันรหัสผ่าน</label
                >
                <input
                  type="password"
                  class="form-control"
                  id="confirm_password"
                  name="confirm_password"
                />
              </div>

              <div class="mb-3">
                <label for="liff_id" class="form-label">LINE LIFF ID</label>
                <input
                  type="text"
                  class="form-control"
                  id="liff_id"
                  name="liff_id"
                />
                <div class="form-text">รหัส LIFF ID สำหรับการลงเวลา</div>
              </div>
            </div>
          </div>
        </div>

        <!-- สถานะระบบ -->
        <div class="col-lg-6 col-md-12">
          <div class="card settings-card">
            <div class="card-header bg-white">
              <div class="d-flex align-items-center">
                <div class="settings-icon bg-info bg-opacity-10 text-info me-3">
                  <i class="fas fa-info-circle"></i>
                </div>
                <h5 class="mb-0">สถานะระบบ</h5>
              </div>
            </div>
            <div class="card-body">
              <div class="mb-3 border-bottom pb-3">
                <div class="d-flex justify-content-between">
                  <span>เวอร์ชัน:</span>
                  <span class="badge bg-primary">1.0.0</span>
                </div>
              </div>
              <div class="mb-3 border-bottom pb-3">
                <div class="d-flex justify-content-between">
                  <span>วันที่เริ่มใช้งาน:</span>
                  <span id="installDate" class="fw-bold">-</span>
                </div>
              </div>
              <div class="mb-3 border-bottom pb-3">
                <div class="d-flex justify-content-between">
                  <span>จำนวนพนักงาน:</span>
                  <span
                    id="employeeCount"
                    class="badge bg-success rounded-pill fs-6"
                    >-</span
                  >
                </div>
              </div>
              <div class="mb-3">
                <div class="d-flex justify-content-between">
                  <span>จำนวนบันทึกเวลา:</span>
                  <span id="logCount" class="badge bg-info rounded-pill fs-6"
                    >-</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ฟุตเตอร์ -->
    <footer class="bg-light py-3 mt-5 border-top">
      <div class="container text-center text-muted small">
        &copy; <span id="currentYear"></span> ระบบลงเวลาออนไลน์ | พัฒนาโดย
        ผู้ช่วยเจ้าพนักงานธุรการ สำนักปลัด
      </div>
    </footer>

    <!-- Modal แบบฟอร์มกลุ่ม Telegram -->
    <div class="modal fade" id="telegramGroupModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="groupModalTitle">
              เพิ่มกลุ่ม Telegram
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="group_index" value="-1" />
            <div class="mb-3">
              <label for="group_name" class="form-label">ชื่อกลุ่ม</label>
              <input
                type="text"
                class="form-control"
                id="group_name"
                placeholder="เช่น กลุ่มหลัก, กลุ่มผู้บริหาร"
              />
            </div>
            <div class="mb-3">
              <label for="group_chat_id" class="form-label">Chat ID</label>
              <input
                type="text"
                class="form-control"
                id="group_chat_id"
                placeholder="เช่น -123456789"
              />
              <div class="form-text">
                ใช้ Bot
                <a href="https://t.me/username_to_id_bot" target="_blank"
                  >@username_to_id_bot</a
                >
                เพื่อรับ Chat ID
              </div>
            </div>
            <div class="form-check form-switch custom-switch">
              <input
                class="form-check-input"
                type="checkbox"
                id="group_active"
                checked
              />
              <label class="form-check-label" for="group_active"
                >เปิดใช้งาน</label
              >
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              ยกเลิก
            </button>
            <button type="button" class="btn btn-primary" id="save-group-btn">
              บันทึก
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal ทดสอบการแจ้งเตือน Telegram -->
    <div class="modal fade" id="testNotifyModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">ทดสอบการแจ้งเตือน Telegram</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="test_notify_group" class="form-label"
                >กลุ่มที่ต้องการทดสอบ</label
              >
              <select class="form-select" id="test_notify_group">
                <!-- กลุ่มจะถูกเพิ่มด้วย JavaScript -->
              </select>
            </div>
            <div class="mb-3">
              <label for="test_notify_message" class="form-label"
                >ข้อความทดสอบ</label
              >
              <textarea class="form-control" id="test_notify_message" rows="3">
ทดสอบการแจ้งเตือนจากระบบลงเวลาออนไลน์</textarea
              >
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              ยกเลิก
            </button>
            <button
              type="button"
              class="btn btn-info"
              id="send-test-notify-btn"
            >
              ส่งข้อความ
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal ทดสอบการส่งข้อความผ่าน Google Apps Script -->
    <div class="modal fade" id="testGasModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              ทดสอบการส่งข้อความผ่าน Google Apps Script
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="test_gas_group" class="form-label"
                >กลุ่มที่ต้องการทดสอบ</label
              >
              <select class="form-select" id="test_gas_group">
                <!-- กลุ่มจะถูกเพิ่มด้วย JavaScript -->
              </select>
            </div>
            <div class="mb-3">
              <label for="test_gas_message" class="form-label"
                >ข้อความทดสอบ</label
              >
              <textarea class="form-control" id="test_gas_message" rows="3">
ทดสอบการส่งข้อความผ่าน Google Apps Script</textarea
              >
            </div>
            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                id="test_gas_with_location"
                checked
              />
              <label class="form-check-label" for="test_gas_with_location">
                ทดสอบพร้อมแผนที่ (ใช้พิกัดกรุงเทพฯ)
              </label>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              ยกเลิก
            </button>
            <button
              type="button"
              class="btn btn-success"
              id="send-test-gas-btn"
            >
              ส่งข้อความ
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal แจ้งผลลัพธ์ -->
    <div class="modal fade" id="resultModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="resultModalTitle">แจ้งผล</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div id="resultModalBody"></div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-primary"
              data-bs-dismiss="modal"
            >
              ตกลง
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="../js/settings.js"></script>
  </body>
</html>
